<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>LHC-Forms</title>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-59GQ6JK');</script>
    <!-- End Google Tag Manager -->

    <style id="antiClickjack">
      body{display:none !important;}
    </style>
    <script type="text/javascript">
      if (self === top) {
        var antiClickjack = document.getElementById("antiClickjack");
        antiClickjack.parentNode.removeChild(antiClickjack);
      } else {
        top.location = self.location;
      }
    </script>

    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700"
          rel="stylesheet" type="text/css">
    <script>
      function turnRed() {
        var stuffDiv = document.getElementById('stuffId');
        stuffDiv.style.color = "red";
      }
    </script>
  </head>

  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-59GQ6JK" height="0" width="0" style="display:none;visibility:hidden" title="googletagmanager" sandbox></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!--[if lt IE 9]>
    <p class=alert><b>Note:</b> It appears you are using an unsupported
     version of the IE browser. This website will not work properly with
     IE 8 or below.</p>
    <![endif]-->

    <!-- page header -->
    <div id="sharedHeader"></div>
    <div id="header">
      <a href="https://lhncbc.nlm.nih.gov" title="LHNCBC Home" id="site-logo">
        <img src="lhncbc.jpg" alt="LHNCBC Home" />
      </a>
      <div id="siteNameBox">
        <span id=siteName>LOINC Mapping Validator</span><br>
        <!-- don't feel it's necessary to use a tagline here, but if needed, uncomment and change.
        <span id=tagline>TBD</span>
        -->
      </div>
    </div>
    <!-- end page header -->

    <ul class="nav-links horz-list">
      <li><a href="/" rel="noopener noreferrer">FHIR Tools</a></li>
      <li><a href="/lhcforms" rel="noopener noreferrer">LHC-Forms Demo</a></li>
      <li><a href="https://lhcformbuilder.nlm.nih.gov" target="_blank" rel="noopener noreferrer">Form Builder</a></li>
      <li><a href="https://clinicaltables.nlm.nih.gov"
             target="_blank" rel="noopener noreferrer">Clinical Table Search Service</a></li>
      <li class="last-item"><a id="sdcPageLink" href="/sdc">FHIR SDC SMART App</a></li>
    </ul>

    <div class="page-content">
      <h2 style="text-align: center">The LOINC Mapping Validator</h2>
      <div class="summary">
        This web-based LOINC mapping validation tool uses the
        <a href="https://github.com/lhncbc/loinc-mapping-validator">LOINC Mapping Validator library</a>
        to check whether the LOINC mappings for the records in a given CSV file are appropriate.
        Currently the validator only considers the unit of a record. It works best if the units used
        are UCUM units and can only recognize a limited number of non-UCUM units. This validator may
        be improved down the road to support more non-UCUM units and to take into account the values as
        well as some other factors during validation.
      </div>
      <div id="show-more-less">
        <div class="summary">
          While this is a web-based tool, your data will be processed in your browser and
          will not be sent to or stored on any servers. The results file will be saved/downloaded
          to your computer. Depending on your browser's configuration (settings), you may either
          be prompted to select a location to save, or the file will be saved to
          the pre-configured default location (usually the "Downloads" folder).
          The result file will contain all the columns in the original input file plus 5 new
          columns to indicate the validation results. For more details on the result file, including the
          interpretation of the results, please see
          <a href="https://github.com/lhncbc/loinc-mapping-validator/blob/master/README.md#output-file-format"
          >output file format</a>.
        </div>
        <div class="summary">
          There are different flavors of CSV formats. There is no guarantee that this tool will work with all of them,
          but the csv file saved from Microsoft excel should work. In order to use this validator:
          <ul>
            <li>The input file must be in CSV format using comma as the column separator.</li>
            <li>The first row must be the header (column names) row and column names must be unqiue.</li>
            <li>There must be a column for the LOINC number and a column for the unit.</li>
            <li>If the value in the cell contains commas, double quotes or newlines characters, you will need to
              enclose the value in double quotes and where you want to use double quotes, repeat them twice.<BR/>
              (Example: A cell value of <i>Say "Hi"</i> would become <i>"Say ""Hi""".)</i></li>
          </ul>
        </div>
      </div>
      <a style="text-decoration: underline;"  href="javascript:void(0);"
         onclick="app.showMoreOrLess(this, 'show-more-less');">Show more...</a>

      <h3>Batch Validation of LOINC Mappings in CSV Files</h3> <hr/>
      <div class="content-block">
        <p>
          Please select the file to validate, fill out the LOINC number column name and the unit column name fields below, and
          then click the "Validate" button to process the file. For requirements on the input file format, please
          expand the introductory descriptions in the section above using the
          "<span style="text-decoration: underline">Show more...</span>" link there.
        </p>
        <table class="input">
          <tr>
            <th class="input-label">CSV File to Validate:</th>
            <td><input type="file" id="inputFile"/></td>
          </tr>
          <tr>
            <th class="input-label">What is the column name for the LOINC number?</th>
            <td><input type="text" id="loincCol" placeholder = "LOINC Column Name"/></td>
          </tr>
          <tr>
            <th class="input-label">What is the column name for the UCUM unit?</th>
            <td><input type="text" id="unitCol" placeholder = "Unit Column Name"/></td>
          </tr>
          <tr>
            <th class="input-label"></th>
            <td><button id="uploadAndValidate" onclick="app.uploadAndValidate(); return true;"
                ><b>Validate</b></button></td>
          </tr>
        </table>
        <p style="margin-top: 10px">
          It may take a while. When it finishes, depending on your browser's configuration, it will either ask you to
          specify where to save the results file, or directly save to your browser's pre-configured save location.
          For details on the result file format, please see
          <a href="https://github.com/lhncbc/loinc-mapping-validator/blob/master/README.md#output-file-format"
          >output file format</a>.
        </p>
      </div>
      <h3>Other Ways to Use the LOINC Mapping Validator</h3> <hr/>
      <ul>
        <li>Download <a href="https://github.com/lhncbc/loinc-mapping-validator">the LOINC Mapping Validator library</a>
          and use the command line batch-validation tool that comes with it
        </li>
        <li>Write your own program using
          <a href="https://github.com/lhncbc/loinc-mapping-validator">the LOINC Mapping Validator library</a>
        </li>
      </ul>
    </div>
    <div id="sharedFooter"></div>
    <script src="https://clinicaltables.nlm.nih.gov/shared/loadShared.min.js"></script>
  </body>
</html>
